@model List<String>

@{
    ViewBag.Title = "BIM VIEWER";
}
<script src="~/Scripts/xbim-viewer.debug.bundle.js" type="text/javascript"></script>
<script src="~/Scripts/scenejs.js"></script>

<div class="row">
    <div class="col-md-2 FileList">
        <h4>Models</h4>
        <table class="table table-striped table-bordered">
            @foreach (var item in Model)
            {

                <tr>
                    <td>
                        <a href="#" class="LinkNoDecor" onclick="selectModel(this);"> @item.ToString() </a>
                    </td>
                </tr>

            }
        </table>
    </div>
    @* BIM MODEL VIEWER *@
    <div id="content" class="col-md-10">
        <canvas id="viewer" width="800" height="500"></canvas>
        <script type="text/javascript">
            var canvas = document.getElementById("viewer");

            var errorCheck = xViewer.check();
            if (errorCheck.noErrors) {
                var viewer = new xViewer('viewer'); //this is the viewer that renders the BIM model.
            }

            function setNavigationModeFly() {
                viewer.navigationMode = 'fly';
            }
            function setNavigationModeOrbit() {
                viewer.navigationMode = 'orbit';
            }

            function selectModel(fileName) {
                viewer.stop();
                var file = $(fileName).text();
                file = file.replace(/\s+/g, ''); //removes whitespaces from string. Whitespaces causes the load method to fail.
                viewer.load('/Resources/Data/' + file);
                viewer.start();
            }

            viewer.on('error', function (arg) {
                var container = document.getElementById('errors');
                if (container) {
                    container.innerHTML = "<p class='Error col-md-10' style='height:50px;'>" + arg.message + "</p> <br />" + container.innerHTML;
                }
            });

            // Register a pick handler
            viewer.on("pick",
                function (hit) {

                    // The 'name' property on the first name node on the path
                    // from the picked teapot up to the scene root, eg "blueTeapot"
                    var name = hit.name;
                    alert(name);
                    // Name path, a '.' delimited concatenation of the 'name' properties
                    // of all name nodes on the path down from teh scene root to the
                    // picked teapot.
                    var path = hit.path;
                    alert(path);
                    // Two-element array containing the X,Y canvas coordinates at which we picked
                    var canvasPos = hit.canvasPos;

                    // Three-element array containing the X,Y,Z World-space coordinates at which we picked
                    var worldPos = hit.worldPos;
                    alert(worldPos);
                });

            //window.addEventListener('click', getPos, false);

            //function getPos(e) {
            //    var pos = getMousePos(canvas, e);
            //    posx = pos.x;
            //    posy = pos.y
            //    alert(posx +','+ posy)
            //}

            //function getMousePos(canvas, evt) {
            //    var rect = canvas.getBoundingClientRect();
            //    return {
            //        x: evt.clientX - rect.left,
            //        y: evt.clientY - rect.top
            //    };
            //}

            //viewer.on('loaded', function () {
            //    var errorBox = document.getElementById('errors');
            //    errorBox.style.visibility = false;
            //    viewer.start();
            //});

           

        </script>
        <div id="errors"></div>
    </div>


</div>
<div class="row">
    @* Input for changing navigation modes *@
    <div class="col-md-5 col-md-offset-2">
        <p style="padding-left:80px;">Navigation Options</p>
        <input type="button" value="Keyboard" onclick="setNavigationModeFly()" class="btn btn-primary btn-block" />
        <input type="button" value="Mouse" onclick="setNavigationModeOrbit()" class="btn btn-primary btn-block" />
    </div>



    @* This is for browsing and submitting files to the server *@
    @using (Html.BeginForm("Upload", "ModelViewer", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <div class="col-md-5">
            <div>
                <p style="padding-left:110px;">Upload File</p>

            </div>
            <input type="file" name="file" class="btn btn-primary btn-block" />
            <input type="submit" name="Submit" value="Upload" class="btn btn-primary btn-block" />
        </div>
    }
</div>
<button onclick="viewer.clip()">CLIP</button>
<button onclick="viewer.unclip()">UNCLIP</button>
<span>
    Selected ID: 
    <span id="productId"></span>
</span>

@section Styles {
    <link href="@Url.Content("~/Content/myStyles.css")" rel="stylesheet" type="text/css" />
}

