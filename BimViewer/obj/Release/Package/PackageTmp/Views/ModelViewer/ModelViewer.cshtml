@model List<String>

@{
    ViewBag.Title = "BIM VIEWER";
}
<script src="~/Scripts/xbim-viewer.debug.bundle.js" type="text/javascript"></script>

<div class="row">
    <div class="col-md-2 FileList">
        <h4>Models</h4>
        <table class="table table-striped table-bordered">
            @foreach (var item in Model)
            {

                <tr>
                    <td>
                        <a href="#" class="LinkNoDecor" onclick="selectModel(this);"> @item.ToString() </a>
                    </td>
                </tr>

            }
        </table>
    </div>
    @* BIM MODEL VIEWER *@
    <div id="content" class="col-md-10">
        <canvas id="viewer" width="800" height="500"></canvas>
        <script type="text/javascript">
            var viewer = new xViewer('viewer');
            //viewer.load('/Resources/Data/SampleHouse.wexbim');
            //viewer.start();


            function setNavigationModeFly() {
                viewer.navigationMode = 'fly';
            }
            function setNavigationModeOrbit() {
                viewer.navigationMode = 'orbit';
            }

            function selectModel(fileName) {
                viewer.stop();
                var file = $(fileName).text();
                file = file.replace(/\s+/g, ''); //removes whitespaces from string. Whitespaces causes the load method to fail.
                viewer.load('/Resources/Data/' + file);
                viewer.start();
            }

            viewer.on('error', function (arg) {
                var container = document.getElementById('errors');
                if (container) {
                    container.innerHTML = "<pre class='col-md-10' style='color:red; height:50px;'>" + arg.message + "</pre> <br />" + container.innerHTML;
                }
            });
         
            //viewer.on('loaded', function () {
            //    var errorBox = document.getElementById('errors');
            //    errorBox.style.visibility = false;
            //    viewer.start();
            //});

        </script>
        <div id="errors"></div>
    </div>


</div>
<div class="row">
    @* Input for changing navigation modes *@
    <div class="col-md-5 col-md-offset-2">
        <p style="padding-left:80px;">Navigation Options</p>
        <input type="button" value="Fly" onclick="setNavigationModeFly()" class="btn btn-primary btn-block" />
        <input type="button" value="Orbit" onclick="setNavigationModeOrbit()" class="btn btn-primary btn-block" />
    </div>



    @* This is for browsing and submitting files to the server *@
    @using (Html.BeginForm("Upload", "ModelViewer", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <div class="col-md-5">
            <div>
                <p style="padding-left:110px;">Upload File</p>

            </div>
            <input type="file" name="file" class="btn btn-primary btn-block" />
            <input type="submit" name="Submit" value="Upload" class="btn btn-primary btn-block" />
        </div>
    }
</div>


@section Styles {
    <link href="@Url.Content("~/Content/myStyles.css")" rel="stylesheet" type="text/css" />
}

